#!/user/bin/env python

import sys, os, sqlite3

# Main function - passes commands into their own functions
def diary():
    if '-h' in sys.argv or '--help' in sys.argv:
        help()
    elif 'generate' in sys.argv:
        generate(sys.argv)
    else:
        print("Diary couldn't parse that command.")
        help()

# Help command
def help():
    output = """
Usage:
  diary <command> [options]

Commands:
  generate sqlite       Generates sqlite3 database for diary.

General Options:
  -h, --help            Show help.
    """
    print(output)

# Generate command
def generate(args):
    # Make sure there was a subcommand passed
    if not args.index('generate') >= len(args):
        if args[args.index('generate') + 1] == 'sqlite':
            generate_sqlite()
        else:
            print('The only database currently supported for diary is sqlite3.')
            help()
    else:
        print('You must pass a subcommand to the generate command.')
        help()

# Generate subcommand for sqlite database
def generate_sqlite():
    cwd = os.getcwd()
    connection = sqlite3.connect(os.path.join(cwd, 'log.sqlite3'))
    cursor = connection.cursor()
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS logs
    (inputDT TIMESTAMP, level TEXT, log TEXT)
    ''')
    print('sqlite3 database generated at %s' % os.path.join(cwd, 'log.sqlite3'))

if __name__ == '__main__':
    diary()
